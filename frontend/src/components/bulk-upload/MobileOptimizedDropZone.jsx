import React, { useRef, useState } from 'react';\nimport { Upload, FileSpreadsheet, Smartphone, Zap, Camera } from 'lucide-react';\nimport Button from '../ui/Button';\nimport { cn } from '../../utils/cn';\nimport { useMobileDetection, useTouchGestures } from '../../hooks/useMobileDetection';\n\n/**\n * Zona de drop optimizada específicamente para dispositivos móviles\n * Incluye gestos touch, feedback háptico y interfaz adaptativa\n */\nconst MobileOptimizedDropZone = ({ \n  dragActive = false,\n  onDrop,\n  onDrag,\n  onFileSelect,\n  disabled = false,\n  className = '',\n  ...props \n}) => {\n  const dropZoneRef = useRef(null);\n  const [isPressed, setIsPressed] = useState(false);\n  const [showRipple, setShowRipple] = useState(false);\n  const [ripplePosition, setRipplePosition] = useState({ x: 0, y: 0 });\n  \n  const { isMobile, isTouch, screenSize, orientation } = useMobileDetection();\n\n  // Configurar gestos touch específicos\n  useTouchGestures(dropZoneRef.current, {\n    onTap: (e) => {\n      if (!disabled && onFileSelect) {\n        // Feedback háptico en dispositivos compatibles\n        if (navigator.vibrate) {\n          navigator.vibrate(50); // Vibración corta\n        }\n        \n        // Efecto ripple\n        const rect = dropZoneRef.current.getBoundingClientRect();\n        const touch = e.changedTouches[0];\n        setRipplePosition({\n          x: touch.clientX - rect.left,\n          y: touch.clientY - rect.top\n        });\n        setShowRipple(true);\n        \n        setTimeout(() => setShowRipple(false), 600);\n        \n        onFileSelect();\n      }\n    },\n    onLongPress: (e) => {\n      if (!disabled) {\n        // Vibración más larga para long press\n        if (navigator.vibrate) {\n          navigator.vibrate([100, 50, 100]);\n        }\n      }\n    },\n    tapThreshold: 200,\n    longPressThreshold: 800\n  });\n\n  const handleClick = () => {\n    if (!disabled && onFileSelect && !isTouch) {\n      onFileSelect();\n    }\n  };\n\n  const handleKeyDown = (e) => {\n    if ((e.key === 'Enter' || e.key === ' ') && !disabled) {\n      e.preventDefault();\n      handleClick();\n    }\n  };\n\n  // Estilos específicos para móvil\n  const mobileStyles = {\n    mobile: {\n      portrait: 'min-h-[280px] p-lg',\n      landscape: 'min-h-[200px] p-md'\n    },\n    tablet: {\n      portrait: 'min-h-[320px] p-xl',\n      landscape: 'min-h-[240px] p-lg'\n    },\n    desktop: 'min-h-[400px] p-2xl'\n  };\n\n  const getResponsiveStyles = () => {\n    if (screenSize === 'desktop') return mobileStyles.desktop;\n    \n    const deviceStyles = mobileStyles[screenSize];\n    return deviceStyles[orientation] || deviceStyles.portrait;\n  };\n\n  return (\n    <div\n      ref={dropZoneRef}\n      className={cn(\n        // Estructura base\n        'relative border-2 border-dashed rounded-lg text-center overflow-hidden',\n        'transition-all duration-300 ease-out select-none',\n        'focus:outline-none focus:ring-2 focus:ring-interactive-default focus:ring-opacity-50',\n        \n        // Estilos responsivos\n        getResponsiveStyles(),\n        \n        // Estados normales\n        !dragActive && !disabled && [\n          'border-border-default',\n          !isTouch && 'hover:border-interactive-hover hover:bg-yellow-50 hover:bg-opacity-50 hover:scale-[1.02] cursor-pointer',\n          'active:scale-[0.98]'\n        ],\n        \n        // Estado drag active\n        dragActive && [\n          'border-interactive-default bg-yellow-50 scale-105',\n          'shadow-lexia transform border-solid',\n          'ring-2 ring-interactive-default ring-opacity-30'\n        ],\n        \n        // Estado pressed para touch\n        isPressed && isTouch && [\n          'scale-[0.98] bg-yellow-50'\n        ],\n        \n        // Estado disabled\n        disabled && [\n          'border-border-disabled bg-bg-light opacity-60',\n          'cursor-not-allowed'\n        ],\n        \n        className\n      )}\n      onDrop={onDrop}\n      onDragOver={onDrag}\n      onDragEnter={onDrag}\n      onDragLeave={onDrag}\n      onClick={handleClick}\n      onKeyDown={handleKeyDown}\n      onTouchStart={() => setIsPressed(true)}\n      onTouchEnd={() => setIsPressed(false)}\n      onTouchCancel={() => setIsPressed(false)}\n      tabIndex={disabled ? -1 : 0}\n      role=\"button\"\n      aria-label=\"Área para subir archivo de Excel\"\n      aria-disabled={disabled}\n      {...props}\n    >\n      {/* Efecto de fondo animado */}\n      <div className={cn(\n        'absolute inset-0 opacity-0 transition-opacity duration-300',\n        dragActive && 'opacity-10'\n      )}>\n        <div className=\"w-full h-full bg-interactive-default animate-pulse\" />\n      </div>\n\n      {/* Ondas de ripple effect para touch */}\n      {showRipple && (\n        <div \n          className=\"absolute w-2 h-2 bg-interactive-default rounded-full opacity-30 pointer-events-none animate-ping\"\n          style={{\n            left: ripplePosition.x - 4,\n            top: ripplePosition.y - 4,\n            animationDuration: '0.6s'\n          }}\n        />\n      )}\n\n      {/* Ondas de drag active */}\n      {dragActive && (\n        <>\n          <div className=\"absolute inset-0 border-2 border-interactive-default rounded-lg animate-ping opacity-30\" />\n          <div className=\"absolute inset-2 border-2 border-interactive-default rounded-lg animate-ping opacity-20\" style={{ animationDelay: '0.2s' }} />\n        </>\n      )}\n\n      {/* Contenido principal */}\n      <div className=\"relative z-10 space-y-md md:space-y-lg\">\n        {/* Icono principal adaptativo */}\n        <div className=\"flex justify-center\">\n          <div className={cn(\n            'rounded-2xl flex items-center justify-center transition-all duration-300',\n            // Tamaños adaptativos\n            isMobile ? 'w-16 h-16' : 'w-20 h-20',\n            dragActive ? [\n              'bg-interactive-default shadow-lexia-lg animate-bounce',\n              'scale-110'\n            ] : [\n              'bg-bg-light',\n              !isTouch && 'group-hover:bg-interactive-default hover:scale-110 hover:shadow-lg'\n            ],\n            disabled && 'bg-border-disabled'\n          )}>\n            {dragActive ? (\n              <Zap size={isMobile ? 28 : 36} className=\"text-text-primary\" />\n            ) : isTouch ? (\n              <Smartphone size={isMobile ? 28 : 36} className={cn(\n                'transition-colors duration-300',\n                disabled ? 'text-text-secondary' : 'text-interactive-default'\n              )} />\n            ) : (\n              <Upload \n                size={isMobile ? 28 : 36} \n                className={cn(\n                  'transition-colors duration-300',\n                  disabled ? 'text-text-secondary' : 'text-interactive-default'\n                )}\n              />\n            )}\n          </div>\n        </div>\n\n        {/* Texto principal adaptativo */}\n        <div className=\"space-y-sm\">\n          <h3 className={cn(\n            'font-heading text-text-primary',\n            isMobile ? 'text-heading-h4' : 'text-heading-h3'\n          )}>\n            {dragActive \n              ? '¡Suelta el archivo aquí!' \n              : isTouch \n                ? 'Toca para seleccionar archivo'\n                : 'Arrastra tu archivo Excel aquí'\n            }\n          </h3>\n          \n          <p className={cn(\n            'text-text-secondary mx-auto',\n            isMobile ? 'text-body-auxiliary max-w-xs' : 'text-body-paragraph max-w-sm'\n          )}>\n            {dragActive \n              ? 'Procesaremos tu archivo inmediatamente'\n              : isTouch\n                ? 'Selecciona un archivo .xlsx o .xls desde tu dispositivo'\n                : 'o haz clic para seleccionar un archivo de tu computadora'\n            }\n          </p>\n        </div>\n\n        {/* Botón de acción adaptativo */}\n        <div className=\"flex justify-center\">\n          <Button\n            variant={dragActive ? \"primary\" : \"secondary\"}\n            size={isMobile ? \"md\" : \"lg\"}\n            disabled={disabled}\n            icon={dragActive ? <Zap size={16} /> : isTouch ? <Smartphone size={16} /> : <Upload size={16} />}\n            className={cn(\n              'transition-all duration-300',\n              dragActive && 'animate-pulse-subtle shadow-lexia',\n              isMobile && 'w-full max-w-xs'\n            )}\n            onClick={(e) => {\n              e.stopPropagation();\n              handleClick();\n            }}\n          >\n            {dragActive \n              ? 'Procesar Archivo' \n              : isTouch\n                ? 'Seleccionar Archivo'\n                : 'Elegir Archivo'\n            }\n          </Button>\n        </div>\n\n        {/* Indicadores de formato adaptados */}\n        <div className={cn(\n          'flex justify-center items-center gap-md pt-md border-t border-border-default border-opacity-50',\n          isMobile && 'gap-sm'\n        )}>\n          <div className={cn(\n            'flex items-center gap-xs text-text-secondary',\n            isMobile ? 'text-body-auxiliary' : 'text-body-paragraph'\n          )}>\n            <FileSpreadsheet size={isMobile ? 14 : 16} className=\"text-feedback-success\" />\n            <span>.xlsx</span>\n          </div>\n          <div className=\"w-1 h-1 rounded-full bg-border-default\"></div>\n          <div className={cn(\n            'flex items-center gap-xs text-text-secondary',\n            isMobile ? 'text-body-auxiliary' : 'text-body-paragraph'\n          )}>\n            <FileSpreadsheet size={isMobile ? 14 : 16} className=\"text-feedback-success\" />\n            <span>.xls</span>\n          </div>\n        </div>\n\n        {/* Información adicional adaptada */}\n        <div className={cn(\n          'text-text-secondary space-y-xs',\n          isMobile ? 'text-body-auxiliary' : 'text-body-paragraph'\n        )}>\n          <p>Tamaño máximo: 10MB</p>\n          <p>Hasta {isMobile ? '1K' : '1,000'} registros por archivo</p>\n          {isTouch && (\n            <p className=\"text-interactive-default font-medium\">\n              📱 Optimizado para móvil\n            </p>\n          )}\n        </div>\n      </div>\n\n      {/* Decoración de esquinas adaptativa */}\n      {!isMobile && (\n        <>\n          <div className={cn(\n            'absolute top-4 left-4 w-6 h-6 border-l-2 border-t-2 rounded-tl-lg transition-all duration-300',\n            dragActive ? 'border-interactive-default opacity-100' : 'border-border-default opacity-30'\n          )} />\n          <div className={cn(\n            'absolute top-4 right-4 w-6 h-6 border-r-2 border-t-2 rounded-tr-lg transition-all duration-300',\n            dragActive ? 'border-interactive-default opacity-100' : 'border-border-default opacity-30'\n          )} />\n          <div className={cn(\n            'absolute bottom-4 left-4 w-6 h-6 border-l-2 border-b-2 rounded-bl-lg transition-all duration-300',\n            dragActive ? 'border-interactive-default opacity-100' : 'border-border-default opacity-30'\n          )} />\n          <div className={cn(\n            'absolute bottom-4 right-4 w-6 h-6 border-r-2 border-b-2 rounded-br-lg transition-all duration-300',\n            dragActive ? 'border-interactive-default opacity-100' : 'border-border-default opacity-30'\n          )} />\n        </>\n      )}\n    </div>\n  );\n};\n\nexport default MobileOptimizedDropZone;